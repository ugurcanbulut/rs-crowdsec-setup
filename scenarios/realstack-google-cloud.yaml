type: leaky
name: realstack/google-cloud-asn
description: "Block Google datacenter IPs (ASN 396982) except legitimate Google crawlers"
filter: |
  evt.Meta.ASNNumber == "396982" &&
  !(
    evt.Meta.http_user_agent matches "(?i).*Googlebot.*" ||
    evt.Meta.http_user_agent matches "(?i).*AdsBot-Google.*" ||
    evt.Meta.http_user_agent matches "(?i).*Storebot-Google.*" ||
    evt.Meta.http_user_agent matches "(?i).*Google-Site-Verification.*" ||
    evt.Meta.http_user_agent matches "(?i).*GoogleProducer.*" ||
    evt.Meta.http_user_agent matches "(?i).*Google-Read-Aloud.*" ||
    evt.Meta.http_user_agent matches "(?i).*Google-PhysicalWeb.*" ||
    evt.Meta.http_user_agent matches "(?i).*GoogleOther.*"
  )
capacity: 1
leakspeed: 1m
groupby: "evt.Meta.source_ip"
blackhole: 2m
labels:
  confidence: 1
  spoofable: 0
  classification:
    - attack.T1583.006  # Acquire Infrastructure: Web Services
    - attack.T1190      # Exploit Public-Facing Application
  behavior: "http:abuse-cloud-provider"
  label: "Google Cloud ASN Abuse"
  service: http
  remediation: true